d3.queue().defer(d3.csv,"data/processed/northern_hemisphere.csv").defer(d3.csv,"data/processed/southern_hemisphere.csv").await(function(u,e,k,v){function w(a,c){m.forEach(function(b,d){var g=d+1,h=10>g?"0"+g:g+"",g=c.filter(function(a){return a.string_month===h}),l=n(g,!0);d3.select("#"+a).append("div").attr("class","graph").attr("id",a+"-graphed"+d);d3.select("#"+a+"-graphed"+d).append("h4").attr("class","text-center text-top").text(m[d]);p("#"+a+"-graphed"+d,g);x("#"+a+"-graphed"+d,q(),g,l)})}function q(){return d3.tip().attr("class","d3-tip").html(function(a){var c=parseInt(a.string_month,10)-1;return'<h4 class="text-center">'+m[c]+" ("+a.year+')</h4><ul class="list-unstyled"><li class="text-center"><h4>Sea Ice Extent</h4></li><li>Hist Avg: '+r(a.value-a.anomaly)+" M square km</li><li>Actual Avg: "+r(a.value)+" M square km</li><li>Dept from Avg: "+r(a.anomaly)+" M square km</li></ul>"})}function y(a,c,b,d){a.forEach(function(a,h){d3.select("#"+c).append("div").attr("class","graph").attr("id",c+"-graphed"+h);d3.select("#"+c+"-graphed"+
    h).append("h4").attr("class","text-center text-top").text(a.key);x("#"+c+"-graphed"+h,b,a.values,d)})}function n(a,c){var b,d;void 0!==c?(b="date",d=280):(b="month",d=72);d=d3.scaleTime().range([0,d]);d.domain(d3.extent(a,d3.f(b)));return d}function z(a,c){return d3.nest().key(function(b){return b[a]}).entries(c)}function A(a,c){return d3.nest().key(function(b){return b[a]}).rollup(function(a){return d3.mean(a,d3.f("value"))}).entries(c)}function f(a,c){var b=d3.swoopyDrag().x(function(a){return a.xVal}).y(function(a){return a.yVal}).draggable(0);
    b.annotations(c);d3.select(a+" .svg").append("g.annotations").call(b)}function x(a,c,b,d){var g,h,l,e;/month/.test(a)?(g="date",h=280,l=170,e=0):(g="month",h=72,l=110,e=t.left);var f=B(b);a=d3.select(a).append("svg").attr("width",h+t.left+t.right).attr("height",l).attr("class","svg").call(c).selectAll("bar").data(b);a.enter().append("rect").merge(a).attr("x",function(a){return d(a[g])}).attr("width",_.floor(h/b.length,3)).attr("y",0).attr("height",80).translate([e,0]).style("fill",function(a){return f(a.anomaly)}).on("mouseover touchstart",
    function(a){d3.select(this).attr("height",100).style("fill","lightgray");c.show.call(this,a)}).on("mouseout touchend",function(a){d3.select(this).attr("height",80).style("fill",function(a){return f(a.anomaly)});c.hide.call(this,a)});a.exit().remove();return a}function B(a){return d3.scaleQuantize().domain(d3.extent(a,d3.f("anomaly"))).range(E)}function p(a,c){var b=window.innerWidth,d=B(c),g=/month/.test(a),h,e;750>b||g?(h=40,e="vertical"):(h=70,e="horizontal");var f="vertical"===e?230:75,g=750>b||
    g?130:b-10,b=a.substr(1),f=d3.select(a).append("svg").classed("legend",!0).attr("width",g).attr("height",f);f.append("g").attr("class","legend-"+b).attr("width",g).translate([0,20]);d=d3.legendColor().shapeWidth(h).orient(e).labelFormat(d3.format(".02f")).scale(d);f.select(".legend-"+b).call(d);return f}var t={top:25,right:50,bottom:50,left:40},C=d3.timeParse("%m/%Y"),D=d3.timeParse("%m"),r=d3.format(".2f"),m="January February March April May June July August September October November December".split(" "),
    E="#f7fbff #deebf7 #c6dbef #9ecae1 #6baed6 #4292c6 #2171b5 #08519c #08306b".split(" ");e.forEach(function(a){a.string_month=a.month;a.date=C(a.string_month+"/"+a.year);a.month=D(a.month);a.anomaly=+a.anomaly});k.forEach(function(a){a.string_month=a.month;a.date=C(a.string_month+"/"+a.year);a.month=D(a.month);a.anomaly=+a.anomaly});A("string_month",e);A("string_month",k);u=n(e);v=n(k);var F=z("year",e),G=z("year",k);p("#north-legend",e);p("#south-legend",k);y(F,"northern-ice",q(),u);y(G,"southern-ice",
    q(),v);f("#northern-ice-graphed0",[{xVal:"03",yVal:0,path:"M67,99L53,75",text:"Greatest extent on record",textOffset:[10,108]}]);f("#northern-ice-graphed33",[{xVal:"09",yVal:0,path:"M67,99L86,74",text:"Lowest extent on record",textOffset:[17,108]}]);f("#southern-ice-graphed18",[{xVal:"02",yVal:0,path:"M77,98L47,72",text:"Lowest extent on record",textOffset:[17,108]}]);f("#southern-ice-graphed35",[{xVal:"09",yVal:0,path:"M67,99L86,74",text:"Greatest extent on record",textOffset:[10,108]}]);w("northern-month-ice",
    e);w("southern-month-ice",k);f("#northern-month-ice-graphed0",[{xVal:"12",yVal:0,path:"M208,97L271,75",text:"Lowest january level on record",textOffset:[133,113]}]);f("#northern-month-ice-graphed2",[{xVal:"12",yVal:0,path:"M208,97L263,76",text:"Lowest march level on record",textOffset:[133,113]}]);f("#northern-month-ice-graphed4",[{xVal:"12",yVal:0,path:"M208,97L271,75",text:"Lowest may level on record",textOffset:[133,113]}]);f("#northern-month-ice-graphed5",[{xVal:"12",yVal:0,path:"M208,97L271,75",
    text:"Lowest june level on record",textOffset:[133,113]}]);f("#northern-month-ice-graphed9",[{xVal:"12",yVal:0,path:"M208,97L271,75",text:"Lowest october level on record",textOffset:[133,113]}]);e=d3.selectAll(".row");e.classed("opaque",!1);e.classed("hide",!1);d3.selectAll("#load").classed("hide",!0)});