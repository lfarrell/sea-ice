d3.queue().defer(d3.csv,"data/processed/northern_hemisphere.csv").defer(d3.csv,"data/processed/southern_hemisphere.csv").await(function(u,c,g,v){function w(a,b){l.forEach(function(d,e){var k=e+1,E=10>k?"0"+k:k+"",k=b.filter(function(a){return a.string_month===E}),c=m(k,!0);d3.select("#"+a).append("div").attr("class","graph").attr("id",a+"-graphed"+e);d3.select("#"+a+"-graphed"+e).append("h4").attr("class","text-center text-top").text(l[e]);p("#"+a+"-graphed"+e,k);x("#"+a+"-graphed"+e,q(),k,c)})}function q(){return d3.tip().attr("class","d3-tip").html(function(a){var b=parseInt(a.string_month,10)-1;return'<h4 class="text-center">'+l[b]+" ("+a.year+')</h4><ul class="list-unstyled"><li class="text-center"><h4>Sea Ice Extent</h4></li><li>Hist Avg: '+r(a.value-a.anomaly)+" M square km</li><li>Actual Avg: "+r(a.value)+" M square km</li><li>Dept from Avg: "+r(a.anomaly)+" M square km</li></ul>"})}function y(a,b,d,e){a.forEach(function(a,c){d3.select("#"+b).append("div").attr("class","graph").attr("id",b+"-graphed"+c);d3.select("#"+b+"-graphed"+c).append("h4").attr("class","text-center text-top").text(a.key);x("#"+b+"-graphed"+c,d,a.values,e)})}function m(a,b){var d,e;void 0!==b?(d="date",e=280):(d="month",e=72);e=d3.scaleTime().range([0,e]);e.domain(d3.extent(a,d3.f(d)));return e}function z(a,b){return d3.nest().key(function(d){return d[a]}).entries(b)}function A(a,b){return d3.nest().key(function(d){return d[a]}).rollup(function(a){return d3.mean(a,d3.f("value"))}).entries(b)}function f(a,b){var d=d3.swoopyDrag().x(function(a){return a.xVal}).y(function(a){return a.yVal}).draggable(0);
    d.annotations(b);d3.select(a+" .svg").append("g.annotations").call(d)}function x(a,b,d,e){var c,f,n,h;/month/.test(a)?(c="date",f=280,n=170,h=0):(c="month",f=72,n=110,h=t.left);var g=B(d);a=d3.select(a).append("svg").attr("width",f+t.left+t.right).attr("height",n).attr("class","svg").call(b).selectAll("bar").data(d);a.enter().append("rect").merge(a).attr("x",function(a){return e(a[c])}).attr("width",_.floor(f/d.length,3)).attr("y",0).attr("height",80).translate([h,0]).style("fill",function(a){return g(a.anomaly)}).on("mouseover touchstart",
    function(a){d3.select(this).attr("height",100).style("fill","lightgray");b.show.call(this,a)}).on("mouseout touchend",function(a){d3.select(this).attr("height",80).style("fill",function(a){return g(a.anomaly)});b.hide.call(this,a)});a.exit().remove();return a}function B(a){return d3.scaleQuantize().domain(d3.extent(a,d3.f("anomaly"))).range(F)}function p(a,c){var d=window.innerWidth,e=B(c),b=/month/.test(a),f,g;750>d||b?(f=40,g="vertical"):(f=70,g="horizontal");var h="vertical"===g?230:75,b=750>d||
    b?130:d-10,d=a.substr(1),h=d3.select(a).append("svg").classed("legend",!0).attr("width",b).attr("height",h);h.append("g").attr("class","legend-"+d).attr("width",b).translate([0,20]);e=d3.legendColor().shapeWidth(f).orient(g).labelFormat(d3.format(".02f")).scale(e);h.select(".legend-"+d).call(e);return h}var t={top:25,right:50,bottom:50,left:40},C=d3.timeParse("%m/%Y"),D=d3.timeParse("%m"),r=d3.format(".2f"),l="January February March April May June July August September October November December".split(" "),
    F="#f7fbff #deebf7 #c6dbef #9ecae1 #6baed6 #4292c6 #2171b5 #08519c #08306b".split(" ");c.forEach(function(a){a.string_month=a.month;a.date=C(a.string_month+"/"+a.year);a.month=D(a.month);a.anomaly=+a.anomaly});g.forEach(function(a){a.string_month=a.month;a.date=C(a.string_month+"/"+a.year);a.month=D(a.month);a.anomaly=+a.anomaly});A("string_month",c);A("string_month",g);u=m(c);v=m(g);var G=z("year",c),H=z("year",g);p("#north-legend",c);p("#south-legend",g);y(G,"northern-ice",q(),u);y(H,"southern-ice",
    q(),v);f("#northern-ice-graphed0",[{xVal:"03",yVal:0,path:"M67,99L53,75",text:"Greatest extent on record",textOffset:[10,108]}]);f("#northern-ice-graphed33",[{xVal:"09",yVal:0,path:"M67,99L86,74",text:"Lowest extent on record",textOffset:[17,108]}]);f("#southern-ice-graphed18",[{xVal:"02",yVal:0,path:"M77,98L47,72",text:"Lowest extent on record",textOffset:[17,108]}]);f("#southern-ice-graphed35",[{xVal:"09",yVal:0,path:"M67,99L86,74",text:"Greatest extent on record",textOffset:[10,108]}]);w("northern-month-ice",
    c);w("southern-month-ice",g);c=[{xVal:"12",yVal:0,path:"M208,97L271,75",text:"Lowest november level on record",textOffset:[133,113]}];f("#northern-month-ice-graphed0",[{xVal:"12",yVal:0,path:"M208,97L271,75",text:"Lowest january level on record",textOffset:[133,113]}]);f("#northern-month-ice-graphed2",[{xVal:"12",yVal:0,path:"M208,97L263,76",text:"Lowest march level on record",textOffset:[133,113]}]);f("#northern-month-ice-graphed4",[{xVal:"12",yVal:0,path:"M208,97L271,75",text:"Lowest may level on record",textOffset:[133,113]}]);f("#northern-month-ice-graphed5",[{xVal:"12",yVal:0,path:"M208,97L271,75",text:"Lowest june level on record",textOffset:[133,113]}]);f("#northern-month-ice-graphed9",[{xVal:"12",yVal:0,path:"M208,97L271,75",text:"Lowest october level on record",textOffset:[133,113]}]);f("#northern-month-ice-graphed10",c);f("#southern-month-ice-graphed10",c);c=d3.selectAll(".row");c.classed("opaque",!1);c.classed("hide",!1);d3.selectAll("#load").classed("hide",!0)});